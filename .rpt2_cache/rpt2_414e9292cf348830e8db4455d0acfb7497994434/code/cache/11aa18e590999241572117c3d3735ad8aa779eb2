{"code":"import * as tslib_1 from \"tslib\";\r\nimport * as React from \"react\";\r\nimport { useMeasure } from \"./use-measure\";\r\nimport { GridContext } from \"./GridContext\";\r\nimport { GridItem } from \"./GridItem\";\r\nimport swap from \"./swap\";\r\nimport { getPositionForIndex, getTargetIndex } from \"./helpers\";\r\nexport function GridDropZone(_a) {\r\n    var items = _a.items, id = _a.id, boxesPerRow = _a.boxesPerRow, children = _a.children, getKey = _a.getKey, _b = _a.disableDrag, disableDrag = _b === void 0 ? false : _b, _c = _a.disableDrop, disableDrop = _c === void 0 ? false : _c, rowHeight = _a.rowHeight, other = tslib_1.__rest(_a, [\"items\", \"id\", \"boxesPerRow\", \"children\", \"getKey\", \"disableDrag\", \"disableDrop\", \"rowHeight\"]);\r\n    var _d = React.useContext(GridContext), traverse = _d.traverse, startTraverse = _d.startTraverse, endTraverse = _d.endTraverse, register = _d.register, onChange = _d.onChange, remove = _d.remove, getActiveDropId = _d.getActiveDropId;\r\n    var ref = React.useRef(null);\r\n    var bounds = useMeasure(ref).bounds;\r\n    var _e = tslib_1.__read(React.useState(null), 2), draggingIndex = _e[0], setDraggingIndex = _e[1];\r\n    var _f = tslib_1.__read(React.useState(null), 2), placeholder = _f[0], setPlaceholder = _f[1];\r\n    var traverseIndex = traverse && !traverse.execute && traverse.targetId === id\r\n        ? traverse.targetIndex\r\n        : null;\r\n    var grid = {\r\n        columnWidth: bounds.width / boxesPerRow,\r\n        boxesPerRow: boxesPerRow,\r\n        rowHeight: rowHeight\r\n    };\r\n    /**\r\n     * Register our dropzone with our grid context\r\n     */\r\n    React.useEffect(function () {\r\n        register(id, {\r\n            top: bounds.top,\r\n            bottom: bounds.bottom,\r\n            left: bounds.left,\r\n            right: bounds.right,\r\n            width: bounds.width,\r\n            height: bounds.height,\r\n            count: items.length,\r\n            grid: grid,\r\n            disableDrop: disableDrop\r\n        });\r\n    }, [items, disableDrop, bounds, id, grid]);\r\n    /**\r\n     * Unregister when unmounting\r\n     */\r\n    React.useEffect(function () {\r\n        return function () { return remove(id); };\r\n    }, [id]);\r\n    // keep an initial list of our item indexes. We use this\r\n    // when animating swap positions on drag events\r\n    var itemsIndexes = items.map(function (_, i) { return i; });\r\n    return (React.createElement(\"div\", tslib_1.__assign({ ref: ref }, other), grid.columnWidth === 0\r\n        ? null\r\n        : items.map(function (item, i) {\r\n            var isTraverseTarget = traverse &&\r\n                traverse.targetId === id &&\r\n                traverse.targetIndex === i;\r\n            var order = placeholder\r\n                ? swap(itemsIndexes, placeholder.startIndex, placeholder.targetIndex)\r\n                : itemsIndexes;\r\n            var pos = getPositionForIndex(order.indexOf(i), grid, traverseIndex);\r\n            /**\r\n             * Handle a child being dragged\r\n             * @param state\r\n             * @param x\r\n             * @param y\r\n             */\r\n            function onMove(state, x, y) {\r\n                if (draggingIndex !== i) {\r\n                    setDraggingIndex(i);\r\n                }\r\n                var targetDropId = getActiveDropId(id, x + grid.columnWidth / 2, y + grid.rowHeight / 2);\r\n                if (targetDropId && targetDropId !== id) {\r\n                    startTraverse(id, targetDropId, x, y, i);\r\n                }\r\n                else {\r\n                    endTraverse();\r\n                }\r\n                var targetIndex = targetDropId !== id\r\n                    ? items.length\r\n                    : getTargetIndex(i, grid, items.length, state.delta[0], state.delta[1]);\r\n                if (targetIndex !== i) {\r\n                    if ((placeholder && placeholder.targetIndex !== targetIndex) ||\r\n                        !placeholder) {\r\n                        setPlaceholder({\r\n                            targetIndex: targetIndex,\r\n                            startIndex: i\r\n                        });\r\n                    }\r\n                }\r\n                else if (placeholder) {\r\n                    setPlaceholder(null);\r\n                }\r\n            }\r\n            /**\r\n             * Handle drag end events\r\n             */\r\n            function onEnd(state, x, y) {\r\n                var targetDropId = getActiveDropId(id, x + grid.columnWidth / 2, y + grid.rowHeight / 2);\r\n                var targetIndex = targetDropId !== id\r\n                    ? items.length\r\n                    : getTargetIndex(i, grid, items.length, state.delta[0], state.delta[1]);\r\n                // traverse?\r\n                if (traverse) {\r\n                    onChange(traverse.sourceId, traverse.sourceIndex, traverse.targetIndex, traverse.targetId);\r\n                }\r\n                else {\r\n                    onChange(id, i, targetIndex);\r\n                }\r\n                setPlaceholder(null);\r\n                setDraggingIndex(null);\r\n            }\r\n            return (React.createElement(GridItem, { key: getKey(item), item: item, top: pos.xy[1], disableDrag: disableDrag, endTraverse: endTraverse, mountWithTraverseTarget: isTraverseTarget ? [traverse.tx, traverse.ty] : undefined, left: pos.xy[0], i: i, onMove: onMove, onEnd: onEnd, grid: grid, dragging: i === draggingIndex }, children));\r\n        })));\r\n}\r\n","dts":{"name":"/Users/bmcmahen/Web/react-dnd-grid/GridDropZone.d.ts","writeByteOrderMark":false,"text":"import * as React from \"react\";\r\nimport { ChildRender } from \"./grid-types\";\r\ndeclare type GridDropZoneProps<T> = {\r\n    items: T[];\r\n    boxesPerRow: number;\r\n    rowHeight: number;\r\n    id: string;\r\n    getKey: (item: T) => string | number;\r\n    children: ChildRender<T>;\r\n    disableDrag?: boolean;\r\n    disableDrop?: boolean;\r\n    style?: React.CSSProperties;\r\n};\r\nexport declare function GridDropZone<T>({ items, id, boxesPerRow, children, getKey, disableDrag, disableDrop, rowHeight, ...other }: GridDropZoneProps<T>): JSX.Element;\r\nexport {};\r\n"}}
